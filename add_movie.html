<script>
const button = document.getElementById("addMovieBtn");

button.addEventListener("click", async () => {
    const name = document.getElementById("movieName").value.trim();
    const resultDiv = document.getElementById("result");
    const errorDiv = document.getElementById("error");
    resultDiv.textContent = "";
    errorDiv.textContent = "";

    if (!name) {
        errorDiv.textContent = "Please enter a movie name.";
        return;
    }

    button.disabled = true;
    button.textContent = "Adding...";

    try {
        const response = await fetch("https://player-helper.onrender.com/add_movie", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name })
        });

        const data = await response.json();
        if (data.success) {
            // Show movie title or 'undefined' and include the movie ID
            const movieTitle = data.title !== undefined ? data.title : "undefined";
            const movieId = data.id !== undefined ? data.id : "N/A";

            resultDiv.textContent = `Movie "${movieTitle}" added successfully! ID: ${movieId}`;
            document.getElementById("movieName").value = "";

            // Keep the message visible for 5 seconds before redirecting (optional)
            setTimeout(() => {
                resultDiv.textContent = "";
                window.location.href = "movies.html"; // comment this line if you don't want redirect
            }, 5000);

        } else {
            errorDiv.textContent = data.error || "Something went wrong.";
            // Keep error visible for 15 seconds
            setTimeout(() => errorDiv.textContent = "", 15000);
        }
    } catch (err) {
        errorDiv.textContent = "Error connecting to backend.";
        console.error(err);
        setTimeout(() => errorDiv.textContent = "", 5000);
    } finally {
        button.disabled = false;
        button.textContent = "Add Movie";
    }
});
</script>
